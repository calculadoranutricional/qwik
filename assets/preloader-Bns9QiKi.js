const f=document,I="modulepreload",_="preload",u={t:0,o:25,l:.65},x=f.createElement("link").relList.supports(I)?I:_,k=Date.now(),v=/\.[mc]?js$/,B=0,L=1,m=2,Q=3,j=4,h=new Map;let g,p=0;const i=[],d=(...t)=>{console.log(`Preloader ${Date.now()-k}ms ${p}/${i.length} queued>`,...t)},A=()=>{g&&(i.sort((t,n)=>t.u-n.u),g=0)},S=()=>{if(i.length){for(A();i.length;){const t=i[0],e=1-t.u,o=c?u.o:5;if(e>=.99||p<o)i.shift(),C(t);else break}if(u.t&&!i.length){const t=[...h.values()].filter(o=>o.i>B),n=t.reduce((o,s)=>o+s.p,0),e=t.reduce((o,s)=>o+s.$,0);d(`>>>> done ${t.length}/${h.size} total: ${n}ms waited, ${e}ms loaded`)}}},C=t=>{if(t.i>=m)return;p++;const n=Date.now();t.p=n-t.m,t.i=m,u.t&&d(`<< load ${Math.round((1-t.u)*100)}% after ${`${t.p}ms`}`,t.B);const e=f.createElement("link");e.href=new URL(`${b}${t.B}`,f.baseURI).toString(),e.rel=x,e.as="script",e.onload=e.onerror=()=>{p--;const o=Date.now();t.$=o-n,t.i=j,u.t&&d(`>> done after ${t.$}ms`,t.B),e.remove(),S()},f.head.appendChild(e)},w=(t,n,e)=>{if(e?.has(t))return;const o=t.u;if(t.u=n,!(o-t.u<.01)&&(b!=null&&t.i<m&&(t.i===B&&(t.i=L,i.push(t),u.t&&d(`queued ${Math.round((1-t.u)*100)}%`,t.B)),g=1),t.h)){e||=new Set,e.add(t);const s=1-t.u;for(const l of t.h){const r=q(l.B);if(r.u===0)continue;let a;if(s===1||s>=.99&&$<100)$++,a=Math.min(.01,1-l.S);else{const M=1-l.S*s,P=l.q,y=M/P;a=Math.max(.02,r.u*y),l.q=y}w(r,a,e)}}},D=(t,n)=>{const e=q(t);e&&e.u>n&&w(e,n)};let $;const E=(t,n)=>{if(!t?.length)return;$=0;let e=n?1-n:.4;if(Array.isArray(t))for(let o=t.length-1;o>=0;o--){const s=t[o];typeof s=="number"?e=1-s/10:D(s,e)}else D(t,e);S()};document.addEventListener("qsymbol",t=>{const{symbol:n,href:e}=t.detail;if(e){const o=n.slice(n.lastIndexOf("_")+1);E(o,1)}});let b,c;const G=(t,n)=>({B:t,i:v.test(t)?B:Q,h:n,u:1,m:Date.now(),p:0,$:0}),O=t=>{const n=new Map;let e=0;for(;e<t.length;){const o=t[e++],s=[];let l,r=1;for(;l=t[e],typeof l=="number";)l<0?r=-l/10:s.push({B:t[l],S:r,q:1}),e++;n.set(o,s)}return n},q=t=>{let n=h.get(t);if(!n){let e;if(c){if(e=c.get(t),!e)return;e.length||(e=void 0)}n=G(t,e),h.set(t,n)}return n},R=(t,n,e)=>{e&&("d"in e&&(u.t=!!e.d),"P"in e&&(u.o=e.P),"Q"in e&&(u.l=1-e.Q)),t!=null&&(b=t,n&&n.then(o=>o.text()).then(o=>{c=O(JSON.parse(o));const s=[];for(const[l,r]of c.entries()){const a=q(l);a.h=r,a.u<1&&(s.push([a,a.u]),a.u=1)}u.t&&d(`parseBundleGraph got ${c.size} bundles, adjusting ${s.length}`);for(const[l,r]of s)w(l,r);S()}).catch(console.warn))};export{O as g,D as h,R as l,E as p};
